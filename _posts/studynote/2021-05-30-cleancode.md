---
layout: post
title: "《代码整洁之道》学习笔记"
date: 2021-05-30
author: linliangqi
categories: StudyNote
update: 2021-06-13
---

- [一、整洁代码](#一整洁代码)
- [二、有意义的命名](#二有意义的命名)
- [三、函数](#三函数)
- [四、注释](#四注释)
- [五、格式](#五格式)
- [六、对象和数据结构](#六对象和数据结构)


> 做一个更好的程序员


### 一、整洁代码
* 编程是一件多人合作的事情
* 随着混乱增加，团队生产力会急剧下降
* 简单代码规则：
  * 能通过所有测试；
  * 没有重复代码；
  * 体现系统中的全部设计理念；
  * 包括尽量少的实体，比如类、方法、函数等。
* 时时保持代码整洁，“让营地比你来时更干净。”

### 二、有意义的命名

* 选择体现本意的名称，并指明计量对象和计量单位的名称

    ``` markdown
    # 正例
    int daySinceCreation;
    int elapsedTimeInDays;
    ```

* 不使用小写字母`l`和大写字母`O`作为变量名，少使用外形相似度高的名称
* 对于同一作用范围的两样东西应做有意义的区分，不能添加数字系列来命名，也不能通过拼写错误来区分。废话也是没有意义的区分，假如有一个`Product`类，再有一个`ProductInfo`或`ProductData`类，意思并无区别，这是意义含混的废话。

    ``` markdown
    # 反例
    getActiveAccount();
    getActiveAccounts();
    getActiveAccountInfo();
    # 程序员怎么知道该调用哪一个函数呢？
    ```

* 废话都是冗余。`variable`一词不应该出现在变量名中，`table`一词不应该出现在表名中。`NameString`不会比`Name`更好，区分名称，应该以读者能鉴别的方式来区分。
* 使用读得出来的名称，不使用首字母简写，方便讨论时的交流。
  
    ``` markdown
    Date genymdhms; // 反例
    Date generationTimestamp; // 正例
    ```

* 使用可搜索的名称，对于数字常量来说，应该赋予其便于搜索的名称，即方便查找，也能体现作者的意图。

    ``` markdown
    # 正例
    final int WORK_DAYS_PER_WEEK = 5;
    ```

* 类名和对象名应该是名词或名词短语，例如`Customer`、`WikiPage`等，不应该是动词，避免使用`Manager`、`Data`、`Info`这样的类名；方法名应该是动词或动词短语，如`postPayment`、`deletePage`等，属性访问、属性修改和断言应该根据其值命名，并加上前缀`get`、`set`、`is`。
* 给每个抽象选一个词，并且一以贯之。例如避免使用`fetch`、`retrieve`、`get`等在多个类中给同种方法命名，这会让人觉得这几个方法在做不同的事。
* 添加有意义的语境，对于一个地址信息，将`firstName`、`lastName`、`street`、`houseNumber`、`city`、`state`等变量放在一起时读者很容易意识到这是个地址，但如果有一个方法中只有一个孤零零的`state`变量则会造成疑惑，因此可以添加前缀提供语境，例如`addrFirstName`、`addrLastName`、`addrState`，更好的解决方法是将其封装为一个`Address`类。同时也要避免添加无意义的语境，只要短名称足够清楚，就比长名称好，对于邮政地址、MAC地址和Web地址，在类名取名时分为`PostalAddress`、`MAC`、和`URI`会更好，这样的名称比在`address`上加前缀更为精确，**而精确正是命名的要点**。

### 三、函数
* 短小，函数的规则就是短小。
* 只做一件事，判断函数是否做了不只一件事，就是看它是否能再拆出一个函数。做多件事的函数可能带来副作用，造成意想不到的结果。
* **每个函数中的语句应处于同一抽象层级上，不能将表达基础概念和细节混杂。**
* 令函数参数尽可能的少，便于理解，也便于测试。
* 如果函数需要多个参数，应考虑将其封装为类。
* 避免使用输出参数
    
    ``` markdown
    public void appendFooter(StringBuffer report) // 反例

    report.appendFooter(); // 正例
    ```

* 使用异常替代返回错误码
* 将`try/catch`的主体部分抽离出来形成函数，错误处理也是一件独立的事。
* 重复的代码应该抽象为函数集中到基类中
* 写出完善的代码不是一开始就按照规则写的，应该是先想什么就写什么，再慢慢打磨推敲

### 四、注释
* “别给糟糕的代码加注释——重新写吧。”
* 带有少量注释的整洁而有表达力的代码，要比带有大量注释的零碎而复杂的代码像样的多。
* 必要信息的注释，如与法律有关（版权、著作权声明）的注释。
* TODO注释，可以提醒自己应该做但因某些原因还没做的事情，但要记得定期查看删除不再需要的TODO注释。
* 公共API应编写良好的Javadoc。
* 不写废话的注释。
* 不保留注释掉的代码，这会给读者带来疑问。

### 五、格式
* 垂直方向上的间隔，`package`声明、`import`声明、每个函数之间都要用空白行隔开。
* 实体变量应放在类的顶部。
* 相关函数应放在一起，若某个函数调用了类中另一个函数，则应将被调用函数放在调用函数的下方，这样可以增强整个模块的可读性。
* 空格、缩进的使用，应符合团队规范。

### 六、对象和数据结构
* 封装、抽象是为了隐藏实现，只暴露抽象接口供外界操作，不能一味的给属性设置`getter`、`setter`，这实际上暴露了实现细节，具体应结合实际场景考虑。
* 过程式代码便于在不改动既有数据结构的前提下添加新函数；面向对象代码便于在不改动既有函数的前提下添加新类。
* 得墨忒耳律（The Law of Demeter）认为，类C的方法f只应该调用以下对象的方法：
  * C；
  * 由f创建的对象；
  * 作为参数传递给f的对象；
  * 由C的实体变量持有的对象

* 最为精炼的数据结构是一个只有公共变量、没有函数的类，这种数据结构被称为DTO（Data Transfer Objects），这是一种非常有用的数据结构，常用于应用各层间的信息传递，一般DTO继承Entity类，补充传输过程需要的字段（常用于与数据库通信）。
